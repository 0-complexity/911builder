#!/bin/bash
# create workdir
KVER=4.13.0-19-generic

source initramfs-tools/initramfs.conf

if [ ! -d root ] ; then
	# if the dir exists, we assume that part is already done
	# Otherwise:
	mkdir root
	sudo debootstrap --arch=amd64 ${DISTRO} root
	# add packages
	sudo cp ays-chroot pkglist adaptdistro root
	sudo chroot root chmod +x adaptdistro
	sudo chroot root /adaptdistro
fi

# build initramfs with running kernel modules
[ ! -d ./bin ] && mkdir bin
	
sudo mkinitramfs -d initramfs-tools/ -o bin/ramfs ${KVER}
sudo cp /boot/vmlinuz-${KVER} bin/vmlinuz
sudo chown $(whoami):$(whoami) bin/*


